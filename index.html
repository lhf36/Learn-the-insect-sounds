<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Insect Song Learning Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a, #020617 60%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .game-shell {
      width: 100%;
      max-width: 1100px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.5);
      padding: 20px 22px;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 18px;
    }

    .title-block h1 {
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }

    .title-block p {
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .meta-block {
      text-align: right;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .meta-pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.2);
      border: 1px solid rgba(34, 211, 238, 0.3);
      color: #e0f2fe;
      margin-bottom: 4px;
      font-size: 0.75rem;
      gap: 4px;
    }

    .meta-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22d3ee;
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 18px;
    }

    /* Spectrogram side */

    .spectrogram-panel {
      background: radial-gradient(circle at top, #020617, #020617);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .spectrogram-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #9ca3af;
      padding-bottom: 4px;
    }

    .spec-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.7rem;
      color: #a5b4fc;
    }

    .spec-level {
      font-size: 0.75rem;
      color: #6ee7b7;
    }

    .species-tagline {
      font-size: 0.82rem;
      color: #a5b4fc;
    }

    .spectrogram-frame {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #020617;
      border: 1px solid rgba(55, 65, 81, 0.9);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.8);
      min-height: 220px;
      display: flex;
    }

    .spectrogram-image {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .spectrogram-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.6),
        transparent 20%,
        transparent 70%,
        rgba(15, 23, 42, 0.9)
      );
    }

    .spectrogram-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .play-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .play-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.6);
      background: linear-gradient(to right, #1d243c, #312e81);
      color: #e5e7eb;
      font-size: 0.85rem;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.8);
    }

    .play-button:hover {
      filter: brightness(1.1);
    }

    .play-icon {
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-left: 9px solid #e5e7eb;
    }

    .hint-label {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .feedback-line {
      font-size: 0.85rem;
      min-height: 18px;
    }

    .feedback-line.correct { color: #4ade80; }
    .feedback-line.wrong { color: #fb923c; }

    .fact-box {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: 0.83rem;
      color: #e5e7eb;
    }

    .fact-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .fact-text { font-size: 0.83rem; }

    .photo-box {
      margin-top: 8px;
      padding: 8px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      text-align: center;
    }

    .insect-photo {
      width: 100%;
      max-width: 450px;
      border-radius: 10px;
      display: block;
      margin: 0 auto;
    }

    .credits {
      margin-top: 4px;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .hidden { display: none; }

    /* Answer side */

    .answers-panel {
      background: radial-gradient(circle at top, #020617, #020617);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .question-text {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .question-subtitle {
      font-size: 0.83rem;
      color: #9ca3af;
    }

    .answers-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .answer-btn {
      width: 100%;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease,
        border-color 0.12s ease, background-color 0.12s ease;
    }

    .answer-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 7px 14px rgba(15, 23, 42, 0.9);
      border-color: rgba(129, 140, 248, 0.8);
    }

    .answer-btn.correct-choice {
      background: radial-gradient(circle at top left, #16a34a, #052e16);
      border-color: #22c55e;
    }

    .answer-btn.wrong-choice {
      background: radial-gradient(circle at top left, #b45309, #451a03);
      border-color: #f97316;
    }

    .answer-label { font-weight: 500; }

    .answer-meta {
      font-size: 0.75rem;
      padding: 2px 9px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
      color: #9ca3af;
    }

    .answer-meta.correct {
      background: rgba(22, 163, 74, 0.3);
      color: #bbf7d0;
    }

    .answer-meta.guess {
      background: rgba(59, 130, 246, 0.2);
      color: #bfdbfe;
    }

    .bottom-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .score-text strong { color: #e5e7eb; }

    .next-btn {
      padding: 7px 13px;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.75);
      background: linear-gradient(to right, #4338ca, #7c3aed);
      color: #f9fafb;
      font-size: 0.86rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .next-btn:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .next-arrow { font-size: 1rem; }

    @media (max-width: 840px) {
      .main-layout { grid-template-columns: minmax(0, 1fr); }
      .meta-block { display: none; }
    }

    @media (max-width: 600px) {
      .game-shell { padding: 14px; }
    }
  </style>
</head>
<body>
  <div class="game-shell">
    <header class="game-header">
      <div class="title-block">
        <h1>Insect Song Learning Game</h1>
        <p>Listen to the call and study the spectrogram. Choose which insect is calling.</p>
      </div>
      <div class="meta-block">
        <div class="meta-pill">
          <span class="meta-dot"></span>
          Spectrogram training
        </div>
        <div>Mode: Multiple choice · Single caller</div>
      </div>
    </header>

    <main class="main-layout">
      <!-- Spectrogram + fact + photo -->
      <section class="spectrogram-panel">
        <div class="spectrogram-header">
          <div>
            <div class="spec-label">Visualizing sound</div>
            <div class="species-tagline" id="spec-tagline">Who is calling?</div>
          </div>
          <div class="spec-level" id="spec-region">Region: —</div>
        </div>

        <div class="spectrogram-frame">
          <img id="spectrogram-image" class="spectrogram-image" src="" alt="Spectrogram">
          <div class="spectrogram-overlay"></div>
        </div>

        <div class="spectrogram-footer">
          <div class="play-controls">
            <button id="play-btn" class="play-button" type="button">
              <span class="play-icon"></span>
              <span>Play call</span>
            </button>
            <div class="hint-label">Tip: match the band of energy and the rhythm of pulses.</div>
          </div>
          <div class="feedback-line" id="feedback-line"></div>
        </div>

        <div id="fact-box" class="fact-box">
          <div class="fact-label">After the guess</div>
          <div class="fact-text" id="fact-text">
            Identify the caller to reveal a fun fact.
          </div>
        </div>

        <div id="photo-box" class="photo-box hidden">
          <img id="insect-photo" class="insect-photo" src="" alt="Insect photo">
          <div id="credits" class="credits"></div>
        </div>
      </section>

      <!-- Answers -->
      <section class="answers-panel">
        <div class="question-text">Which insect is producing this sound?</div>
        <div class="question-subtitle">Listen as many times as you like, then choose the common name.</div>

        <div id="answers-list" class="answers-list"></div>

        <div class="bottom-controls">
          <div class="score-text" id="score-text">Score: <strong>0 / 0</strong></div>
          <button id="next-btn" class="next-btn" type="button" disabled>
            Next spectrogram <span class="next-arrow">➜</span>
          </button>
        </div>
      </section>
    </main>

    <audio id="audio-player"></audio>
  </div>

  <script>
    // ---- 1. Data: common names, facts, credits ----

    const SONGS = [
      {
        commonName: "Four-spotted Tree Cricket",
        species: "Oecanthus quadripunctatus",
        image: "images/Four Spotted Tree Cricket_Spectogram_XC861325.jpeg",
        audio: "audio/XC861325 - Four-spotted tree cricket - Oecanthus quadripunctatus_Daniel_Parker.wav",
        photo: "images/Four Spotted Tree Cricket_Photo 100453434, no rights reserved, uploaded by Megan Ralph.jpg",
        region: "North America",
        fact: "Four-spotted tree crickets give high-pitched trills from up in the trees. They amplify their songs by building tools called baffles out of leaves.",
        photoCredit: "Megan Ralph",
        audioCredit: "Daniel Parker"
      },
      {
        commonName: "Swamp Cicada",
        species: "Neotibicen tibicen",
        image: "images/Neotibicen_tibicen_Spectrogram.jpeg",
        audio: "audio/Neotibicen_tibicen_australis_filtered_David_Marshall.mp3",
        photo: "images/Neotibicen tibicen_\"Alie\" Kratzer_Swamp Cicada.jpeg",
        region: "Eastern U.S.",
        fact: "Swamp cicadas produce loud songs by vibrating a thin membrane of an organ on their abdomen called a tymbal. Their songs are so loud that they actually turn down their hearing when they sing to avoid going deaf!",
        photoCredit: "\"Alie\" Kratzer",
        audioCredit: "David Marshall"
      },
      {
        commonName: "Common True Katydid",
        species: "Pterophylla camellifolia",
        image: "images/Pterophylla camellifolia Common True Katydid spectrogram.jpeg",
        audio: "audio/XC1033657 - Pterophylla camellifolia_Francisco_Rivas_Fuenzalida.wav",
        photo: "images/Pterophylla camellifolia  Common true Katydid_Judy Gallagher_Image.jpg",
        region: "Eastern U.S. forests",
        fact: "Common true katydids produce rhythmic songs by rubbing their wings together. Unlike crickets who are righties, katydids are all lefties and rub their left wing over their right wings.",
        photoCredit: "Judy Gallagher",
        audioCredit: "Francisco Rivas Fuenzalida"
      },
      {
        commonName: "Meadow Grasshopper",
        species: "Pseudochorthippus parallelus",
        image: "images/Meadow Grasshopper Spectrogram.jpeg",
        audio: "audio/XC446417 - Meadow Grasshopper - Pseudochorthippus parallelus_Baudewijn_Ode .mp3",
        photo: "images/Meadow Grasshopper_Gilles_San_Martin.jpg",
        region: "European grasslands",
        fact: "Male meadow grasshoppers create their percussive songs by rubbing their hind legs against hard forewings. Most grasshoppers don't actually sing, but some of the few species that do can be very easy to find.",
        photoCredit: "Gilles San Martin",
        audioCredit: "Baudewijn Ode"
      }
    ];

    const ALL_COMMON_NAMES = SONGS.map(s => s.commonName);

    // ---- 2. State ----

    let scoreCorrect = 0;
    let scoreTotal = 0;
    let hasAnswered = false;

    // playlist to ensure each species appears once per cycle
    let playlist = [];
    let playlistIndex = 0;
    let currentSong = null;

    const spectrogramImageEl = document.getElementById("spectrogram-image");
    const specTaglineEl = document.getElementById("spec-tagline");
    const specRegionEl = document.getElementById("spec-region");
    const factTextEl = document.getElementById("fact-text");
    const feedbackLineEl = document.getElementById("feedback-line");
    const answersListEl = document.getElementById("answers-list");
    const scoreTextEl = document.getElementById("score-text");
    const playBtnEl = document.getElementById("play-btn");
    const nextBtnEl = document.getElementById("next-btn");
    const audioPlayerEl = document.getElementById("audio-player");
    const photoBoxEl = document.getElementById("photo-box");
    const insectPhotoEl = document.getElementById("insect-photo");
    const creditsEl = document.getElementById("credits");

    // ---- 3. Helpers ----

    function shuffleArray(arr) {
      return arr
        .map(v => ({ v, r: Math.random() }))
        .sort((a, b) => a.r - b.r)
        .map(x => x.v);
    }

    function initPlaylist() {
      playlist = shuffleArray(SONGS.slice());
      playlistIndex = 0;
    }

    function getNextSong() {
      if (playlist.length === 0 || playlistIndex >= playlist.length) {
        initPlaylist();
      }
      return playlist[playlistIndex++];
    }

    function buildChoices(correctName) {
      const others = ALL_COMMON_NAMES.filter(n => n !== correctName);
      const numOptions = Math.min(4, ALL_COMMON_NAMES.length);
      const wrong = shuffleArray(others).slice(0, numOptions - 1);
      return shuffleArray([correctName, ...wrong]);
    }

    // ---- 4. Rendering ----

    function renderSpectrogram(song) {
      spectrogramImageEl.src = song.image;
      spectrogramImageEl.alt = `Spectrogram of ${song.commonName} call`;

      specTaglineEl.textContent = "Who is calling?";
      specRegionEl.textContent = song.region ? `Region: ${song.region}` : "Region: —";

      factTextEl.textContent = "Identify the caller to reveal a fun fact.";
      feedbackLineEl.textContent = "";
      feedbackLineEl.className = "feedback-line";

      insectPhotoEl.src = "";
      photoBoxEl.classList.add("hidden");
      creditsEl.textContent = "";

      audioPlayerEl.src = song.audio;
    }

    function renderAnswers(song) {
      answersListEl.innerHTML = "";
      const choices = buildChoices(song.commonName);

      choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "answer-btn";

        const label = document.createElement("span");
        label.className = "answer-label";
        label.textContent = choice;

        const meta = document.createElement("span");
        meta.className = "answer-meta";
        meta.textContent = "Guess";

        btn.appendChild(label);
        btn.appendChild(meta);

        btn.addEventListener("click", () => handleAnswer(choice, btn));
        answersListEl.appendChild(btn);
      });
    }

    // ---- 5. Interaction ----

    function handleAnswer(selectedName, buttonEl) {
      if (hasAnswered) return;
      hasAnswered = true;
      scoreTotal++;

      const correct = selectedName === currentSong.commonName;

      if (correct) {
        scoreCorrect++;
        feedbackLineEl.textContent = "Correct! Nice listening.";
        feedbackLineEl.classList.add("correct");
      } else {
        feedbackLineEl.textContent = `Not quite. This spectrogram belongs to ${currentSong.commonName}.`;
        feedbackLineEl.classList.add("wrong");
      }

      specTaglineEl.textContent = currentSong.commonName;
      factTextEl.textContent = currentSong.fact || "";

      insectPhotoEl.src = currentSong.photo;
      photoBoxEl.classList.remove("hidden");
      creditsEl.textContent = `Photo: ${currentSong.photoCredit} · Audio: ${currentSong.audioCredit}`;

      const buttons = answersListEl.querySelectorAll(".answer-btn");
      buttons.forEach(btn => {
        const label = btn.querySelector(".answer-label").textContent;
        const meta = btn.querySelector(".answer-meta");

        if (label === currentSong.commonName) {
          btn.classList.add("correct-choice");
          meta.textContent = "Answer";
          meta.classList.add("correct");
        }
        if (btn === buttonEl && !correct) {
          btn.classList.add("wrong-choice");
          meta.textContent = "Your guess";
          meta.classList.add("guess");
        }
        btn.disabled = true;
      });

      scoreTextEl.innerHTML = `Score: <strong>${scoreCorrect} / ${scoreTotal}</strong>`;
      nextBtnEl.disabled = false;
    }

    function loadNewRound() {
      hasAnswered = false;
      nextBtnEl.disabled = true;
      currentSong = getNextSong();
      renderSpectrogram(currentSong);
      renderAnswers(currentSong);
    }

    // ---- 6. Events ----

    playBtnEl.addEventListener("click", () => {
      audioPlayerEl.currentTime = 0;
      audioPlayerEl.play().catch(() => {});
    });

    nextBtnEl.addEventListener("click", loadNewRound);

    // Kick off
    initPlaylist();
    loadNewRound();
  </script>
</body>
</html>
